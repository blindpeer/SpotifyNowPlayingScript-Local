<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Spotify NP Script (Local Edition) v1.7</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    /* Dark theme */
    html, body {
      margin: 0;
      padding: 1rem;
      background: #121212;
      color: #e0e0e0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      line-height: 1.5;
    }
    h1, h2 {
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #fff;
    }
    h1 {
      border-bottom: 1px solid #333;
      padding-bottom: 0.3rem;
    }
    p, li {
      margin-bottom: 0.75rem;
    }
    code {
      background: #1e1e1e;
      padding: 0.2rem 0.4rem;
      border-radius: 3px;
      font-size: 0.95em;
    }
    pre {
      background: #1e1e1e;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      margin: 1rem 0;
    }
    ul {
      padding-left: 1.2rem;
    }
    a {
      color: #80cbc4;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .badge {
      display: inline-block;
      margin-right: 0.5rem;
    }
    footer {
      margin-top: 2rem;
      border-top: 1px solid #333;
      padding-top: 1rem;
      font-size: 0.9em;
      color: #aaa;
    }
  </style>
</head>
<body>
  <h1>Spotify NP Script (Local Edition) v1.7</h1>
  <p><strong>Maker:</strong> blind_peer</p>

  <h2>Description</h2>
  <p>
    Spotify Now Playing Script (Local Edition) is a small, self-hosted tool that lets you post your current Spotify “Now Playing” into any chat client via a simple <code>/me</code> command. It uses a browser bookmarklet plus two lightweight local servers (an HTTP redirect page and a Flask proxy) to handle Spotify’s PKCE OAuth flow, token exchange, and silent refresh—now with built-in throttling to prevent duplicate posts under lag.
  </p>
  <p><strong>What the script will do:</strong></p>
  <ul>
    <li>Prompts for your Spotify Client ID.</li>
    <li>Generates the core files:
      <ul>
        <li><code>index.html</code></li>
        <li><code>proxy.py</code></li>
        <li><code>run-proxy-py.bat</code></li>
        <li><code>run-all-servers.bat</code></li>
        <li><code>bookmarklet.txt</code></li>
      </ul>
    </li>
    <li>Creates a Python virtualenv (<code>venv</code>) and installs Flask + dependencies.</li>
    <li>Offers to start the local servers immediately.</li>
  </ul>

  <h2>Features</h2>
  <ul>
    <li>One-click “Now Playing” <code>/me</code> command via a browser bookmarklet</li>
    <li>Secure PKCE authorization (no client secret exposed)</li>
    <li>Local Flask proxy for token and refresh exchanges (no public CORS proxy)</li>
    <li>Automatic refresh-token support (no re-authorization every hour)</li>
    <li>Persistent 5 second throttle to prevent flooding under lag</li>
    <li>Customizable message format:
      <pre>/me is now playing: Artist – Track [Album] (https://open.spotify.com/...)</pre>
    </li>
  </ul>

  <h2>Contents</h2>
  <ul>
    <li><strong>index.html</strong> – Landing page & OAuth redirect callback (http://127.0.0.1:8000)</li>
    <li><strong>proxy.py</strong> – Flask app (http://127.0.0.1:8888) for <code>/api/token</code> and <code>/api/refresh</code></li>
    <li><strong>run-proxy-py.bat</strong> – Batch script to launch <code>proxy.py</code> inside a Python venv</li>
    <li><strong>run-all-servers.bat</strong> – Batch script to launch both the HTTP server (8000) and the proxy (8888)</li>
    <li><strong>bookmarklet.txt</strong> – The one-line JavaScript bookmarklet for your browser</li>
    <li><strong>venv/</strong> – Python virtual environment with Flask, requests, flask-cors</li>
  </ul>

  <h2>Prerequisites</h2>
  <ul>
    <li>Windows 10 or 11</li>
    <li>Python 3.7+ on your <code>PATH</code></li>
    <li>A registered Spotify app (Client ID only) in the <a href="https://developer.spotify.com/dashboard/">Spotify Developer Dashboard</a>
      <ul>
        <li>Add redirect URI: <code>http://127.0.0.1:8000/index.html</code></li>
      </ul>
    </li>
    <li>A chat client in the browser with a <code>cb().say(...)</code> API</li>
  </ul>

  <h2>Installation</h2>
  <ol>
    <li>Prepare an empty folder, e.g.<br><code>D:\Apps\SpotifyNP\</code></li>
    <li>Copy these two installer files into that folder:
      <ul>
        <li><code>SpotifyNPScript-Local.py</code></li>
        <li><code>Install_SpotifyNPScript-Local.bat</code></li>
      </ul>
    </li>
    <li>(Optional) Open Command Prompt and <code>cd /d D:\Apps\SpotifyNP\</code></li>
    <li>Run the installer:<br><code>Install_SpotifyNPScript-Local.bat</code></li>
    <li>When prompted, enter your <strong>Spotify Client ID</strong> and press Enter.</li>
  </ol>

  <h2>Usage</h2>
  <ol>
    <li>Ensure both servers are running (HTTP 8000, proxy 8888).<br>
      If you skipped “Y” at install, run:<br>
      <code>run-all-servers.bat</code>
    </li>
    <li>Install the bookmarklet:
      <ul>
        <li>Open <code>bookmarklet.txt</code> and copy its contents.</li>
        <li>Create a new browser bookmark and paste the string into its URL field.</li>
      </ul>
    </li>
    <li>On any page with <code>cb().say</code> available, click the bookmarklet:
      <ul>
        <li>First use: authorize Spotify in the popup → post once.</li>
        <li>Subsequent clicks: immediately posts current track.</li>
      </ul>
    </li>
  </ol>

  <h2>Optional: Auto-Start at Login</h2>
  <ol>
    <li>Open Task Scheduler.</li>
    <li>Create a new task triggered “At log on.”</li>
    <li>Action: Start a program → <code>D:\Apps\SpotifyNP\run-all-servers.bat</code></li>
    <li>Check “Run only when user is logged on” and “Hidden.”</li>
    <li>Save.</li>
  </ol>

  <h2>Quickstart</h2>
  <pre>git clone https://github.com/blindpeer/SpotifyNowPlayingScript-Local.git &&
cd SpotifyNowPlayingScript-Local &&
Install_SpotifyNPScript-Local.bat</pre>

  <h2>Support</h2>
  <ul>
    <li><a href="https://github.com/blindpeer/SpotifyNowPlayingScript-Local/issues">Issue Tracker</a></li>
  </ul>

  <footer>
    © 2025 blind_peer | <a href="../LICENSE">Proprietary Non-Commercial License</a>
  </footer>
</body>
</html>
