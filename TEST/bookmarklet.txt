javascript:(async()=>{const CLIENT_ID='edd9f875459749aebb6b75f88f47c662',REDIR='http://127.0.0.1:8000/index.html';function genR(n){const A='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',U=new Uint8Array(n);crypto.getRandomValues(U);return[...U].map(i=>A[i%A.length]).join('')}async function sha256(s){return crypto.subtle.digest('SHA-256',new TextEncoder().encode(s))}function b64u(b){return btoa(String.fromCharCode(...new Uint8Array(b))).replace(/=/g,'').replace(/\+/g,'-').replace(/\//g,'_')}async function postNow(){let t=localStorage.getItem('sp_access_token'),r=await fetch('https://api.spotify.com/v1/me/player/currently-playing',{headers:{Authorization:'Bearer '+t}});if(r.status===401){localStorage.removeItem('sp_access_token');return initAuth()}if(r.status===204)return;if(!r.ok)return;const d=await r.json(),i=d.item,a=i.artists.map(x=>x.name).join(', '),nm=i.name,al=i.album.name,url=i.external_urls.spotify;cb().say(`/me is now playing: ${a} - ${nm} [${al}] (${url})`)}async function initAuth(){const v=genR(64),c=b64u(await sha256(v)),s=b64u(new TextEncoder().encode(v)),p=new URLSearchParams({response_type:'code',client_id:CLIENT_ID,scope:'user-read-currently-playing',redirect_uri:REDIR,code_challenge_method:'S256',code_challenge:c,state:s});const w=window.open('https://accounts.spotify.com/authorize?'+p,'SpotifyAuth','width=450,height=730');if(!w)alert('Please allow pop-ups to authenticate with Spotify.')}window.addEventListener('message',e=>{if(e.data.access_token){localStorage.setItem('sp_access_token',e.data.access_token);localStorage.setItem('sp_refresh_token',e.data.refresh_token);postNow()}});localStorage.getItem('sp_access_token')?postNow():initAuth();})();